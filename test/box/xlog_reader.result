-- test for xlog_reader module
-- consists of 3 parts:
-- 1) ok snap/xlog reader
-- 2) broken files reader (crc sum is invalid, bad header [version/type])
-- 3) before box.cfg and after box.cfg
fio  = require('fio')
---
...
fun  = require('fun')
---
...
json = require('json')
---
...
xlog = require('xlog').pairs
---
...
trun = require('test_run').new()
---
...
-- OK test
pattern_ok_v12 = "../box/xlog_reader/v12/*.ok.*"
---
...
pattern_ok_v13 = "../box/xlog_reader/v13/*.ok.*"
---
...
fio.cwd();
---
- /Users/blikh/src/work/tarantool/test/var
...
trun:cmd("setopt delimiter ';'")
---
- true
...
function collect_results(file)
    local val = {}
    for k, v in xlog(file) do
        table.insert(val, json.encode(v))
    end
    return file, val
end;
---
...
trun:cmd("setopt delimiter ''");
---
- true
...
fun.iter(fio.glob(pattern_ok_v12)):map(collect_results):tomap();
---
- ../box/xlog_reader/v12/00000000000000000000.ok.xlog:
  - '{"BODY":{"space_id":272,"index_base":1,"key":["max_id"],"tuple":[["+",2,1]]},"HEADER":{"type":"UPDATE","timestamp":1476117049.224,"lsn":1,"server_id":1}}'
  - '{"BODY":{"space_id":280,"tuple":[512,1,"test","memtx",0,{},[]]},"HEADER":{"type":"INSERT","timestamp":1476117049.2246,"lsn":2,"server_id":1}}'
  - '{"BODY":{"space_id":288,"tuple":[512,0,"primary","tree",{"unique":true},[[0,"num"]]]},"HEADER":{"type":"INSERT","timestamp":1476117049.2247,"lsn":3,"server_id":1}}'
  - '{"BODY":{"space_id":512,"tuple":[1,2,3,4]},"HEADER":{"type":"INSERT","timestamp":1476117049.2247,"lsn":4,"server_id":1}}'
  - '{"BODY":{"space_id":512,"tuple":[2,2,3,4]},"HEADER":{"type":"REPLACE","timestamp":1476117049.2248,"lsn":5,"server_id":1}}'
  - '{"BODY":{"space_id":512,"key":[1]},"HEADER":{"type":"DELETE","timestamp":1476117049.2248,"lsn":6,"server_id":1}}'
  - '{"BODY":{"space_id":512,"index_base":1,"key":[2],"tuple":[["=",3,4]]},"HEADER":{"type":"UPDATE","timestamp":1476117049.2248,"lsn":7,"server_id":1}}'
  - '{"BODY":{"space_id":512,"operations":[["=",3,4]],"index_base":1,"tuple":[3,4,5,6]},"HEADER":{"type":"UPSERT","timestamp":1476117049.2248,"lsn":8,"server_id":1}}'
  - '{"BODY":{"space_id":512,"operations":[["=",3,4]],"index_base":1,"tuple":[3,4,5,6]},"HEADER":{"type":"UPSERT","timestamp":1476117049.2249,"lsn":9,"server_id":1}}'
  ../box/xlog_reader/v12/00000000000000000000.ok.snap:
  - '{"BODY":{"space_id":272,"tuple":["cluster","c0da3acb-5725-456a-a407-3e7a7550d7a1"]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":1,"server_id":0}}'
  - '{"BODY":{"space_id":272,"tuple":["max_id",511]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":2,"server_id":0}}'
  - '{"BODY":{"space_id":272,"tuple":["version",1,6,8]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":3,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[272,1,"_schema","memtx",0,{},[{"type":"str","name":"key"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":4,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[280,1,"_space","memtx",0,{},[{"name":"id","type":"num"},{"name":"owner","type":"num"},{"name":"name","type":"str"},{"name":"engine","type":"str"},{"name":"field_count","type":"num"},{"name":"flags","type":"str"},{"name":"format","type":"*"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":5,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[281,1,"_vspace","sysview",0,{},[{"name":"id","type":"num"},{"name":"owner","type":"num"},{"name":"name","type":"str"},{"name":"engine","type":"str"},{"name":"field_count","type":"num"},{"name":"flags","type":"str"},{"name":"format","type":"*"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":6,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[288,1,"_index","memtx",0,{},[{"name":"id","type":"num"},{"name":"iid","type":"num"},{"name":"name","type":"str"},{"name":"type","type":"str"},{"name":"opts","type":"array"},{"name":"parts","type":"array"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":7,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[289,1,"_vindex","sysview",0,{},[{"name":"id","type":"num"},{"name":"iid","type":"num"},{"name":"name","type":"str"},{"name":"type","type":"str"},{"name":"opts","type":"array"},{"name":"parts","type":"array"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":8,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[296,1,"_func","memtx",0,{},[{"name":"id","type":"num"},{"name":"owner","type":"num"},{"name":"name","type":"str"},{"name":"setuid","type":"num"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":9,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[297,1,"_vfunc","sysview",0,{},[{"name":"id","type":"num"},{"name":"owner","type":"num"},{"name":"name","type":"str"},{"name":"setuid","type":"num"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":10,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[304,1,"_user","memtx",0,{},[{"name":"id","type":"num"},{"name":"owner","type":"num"},{"name":"name","type":"str"},{"name":"type","type":"str"},{"name":"auth","type":"*"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":11,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[305,1,"_vuser","sysview",0,{},[{"name":"id","type":"num"},{"name":"owner","type":"num"},{"name":"name","type":"str"},{"name":"type","type":"str"},{"name":"auth","type":"*"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":12,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[312,1,"_priv","memtx",0,{},[{"name":"grantor","type":"num"},{"name":"grantee","type":"num"},{"name":"object_type","type":"str"},{"name":"object_id","type":"num"},{"name":"privilege","type":"num"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":13,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[313,1,"_vpriv","sysview",0,{},[{"name":"grantor","type":"num"},{"name":"grantee","type":"num"},{"name":"object_type","type":"str"},{"name":"object_id","type":"num"},{"name":"privilege","type":"num"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":14,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[320,1,"_cluster","memtx",0,{},[{"name":"id","type":"num"},{"name":"uuid","type":"str"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":15,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[272,0,"primary","tree",{"unique":true},[[0,"str"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":16,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[280,0,"primary","tree",{"unique":true},[[0,"num"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":17,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[280,1,"owner","tree",{"unique":false},[[1,"num"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":18,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[280,2,"name","tree",{"unique":true},[[2,"str"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":19,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[281,0,"primary","tree",{"unique":true},[[0,"num"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":20,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[281,1,"owner","tree",{"unique":false},[[1,"num"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":21,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[281,2,"name","tree",{"unique":true},[[2,"str"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":22,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[288,0,"primary","tree",{"unique":true},[[0,"num"],[1,"num"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":23,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[288,2,"name","tree",{"unique":true},[[0,"num"],[2,"str"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":24,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[289,0,"primary","tree",{"unique":true},[[0,"num"],[1,"num"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":25,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[289,2,"name","tree",{"unique":true},[[0,"num"],[2,"str"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":26,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[296,0,"primary","tree",{"unique":true},[[0,"num"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":27,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[296,1,"owner","tree",{"unique":false},[[1,"num"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":28,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[296,2,"name","tree",{"unique":true},[[2,"str"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":29,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[297,0,"primary","tree",{"unique":true},[[0,"num"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":30,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[297,1,"owner","tree",{"unique":false},[[1,"num"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":31,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[297,2,"name","tree",{"unique":true},[[2,"str"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":32,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[304,0,"primary","tree",{"unique":true},[[0,"num"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":33,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[304,1,"owner","tree",{"unique":false},[[1,"num"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":34,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[304,2,"name","tree",{"unique":true},[[2,"str"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":35,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[305,0,"primary","tree",{"unique":true},[[0,"num"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":36,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[305,1,"owner","tree",{"unique":false},[[1,"num"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":37,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[305,2,"name","tree",{"unique":true},[[2,"str"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":38,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[312,0,"primary","tree",{"unique":true},[[1,"num"],[2,"str"],[3,"num"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":39,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[312,1,"owner","tree",{"unique":false},[[0,"num"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":40,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[312,2,"object","tree",{"unique":false},[[2,"str"],[3,"num"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":41,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[313,0,"primary","tree",{"unique":true},[[1,"num"],[2,"str"],[3,"num"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":42,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[313,1,"owner","tree",{"unique":false},[[0,"num"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":43,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[313,2,"object","tree",{"unique":false},[[2,"str"],[3,"num"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":44,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[320,0,"primary","tree",{"unique":true},[[0,"num"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":45,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[320,1,"uuid","tree",{"unique":true},[[1,"str"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":46,"server_id":0}}'
  - '{"BODY":{"space_id":296,"tuple":[1,1,"box.schema.user.info",1,"LUA"]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":47,"server_id":0}}'
  - '{"BODY":{"space_id":304,"tuple":[0,1,"guest","user"]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":48,"server_id":0}}'
  - '{"BODY":{"space_id":304,"tuple":[1,1,"admin","user"]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":49,"server_id":0}}'
  - '{"BODY":{"space_id":304,"tuple":[2,1,"public","role"]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":50,"server_id":0}}'
  - '{"BODY":{"space_id":304,"tuple":[3,1,"replication","role"]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":51,"server_id":0}}'
  - '{"BODY":{"space_id":312,"tuple":[1,0,"role",2,4]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":52,"server_id":0}}'
  - '{"BODY":{"space_id":312,"tuple":[1,1,"universe",0,7]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":53,"server_id":0}}'
  - '{"BODY":{"space_id":312,"tuple":[1,2,"function",1,4]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":54,"server_id":0}}'
  - '{"BODY":{"space_id":312,"tuple":[1,2,"space",281,1]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":55,"server_id":0}}'
  - '{"BODY":{"space_id":312,"tuple":[1,2,"space",289,1]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":56,"server_id":0}}'
  - '{"BODY":{"space_id":312,"tuple":[1,2,"space",297,1]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":57,"server_id":0}}'
  - '{"BODY":{"space_id":312,"tuple":[1,2,"space",305,1]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":58,"server_id":0}}'
  - '{"BODY":{"space_id":312,"tuple":[1,2,"space",313,1]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":59,"server_id":0}}'
  - '{"BODY":{"space_id":312,"tuple":[1,3,"space",320,2]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":60,"server_id":0}}'
  - '{"BODY":{"space_id":312,"tuple":[1,3,"universe",0,1]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":61,"server_id":0}}'
  - '{"BODY":{"space_id":320,"tuple":[1,"0e82a45f-d1ff-4f19-bf2c-b815ad567dab"]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":62,"server_id":0}}'
...
fun.iter(fio.glob(pattern_ok_v13)):map(collect_results):tomap();
---
- ../box/xlog_reader/v13/00000000000000000000.ok.xlog:
  - '{"BODY":{"space_id":272,"index_base":1,"key":["max_id"],"tuple":[["+",2,1]]},"HEADER":{"type":"UPDATE","timestamp":1475796386.2266,"lsn":1,"server_id":1}}'
  - '{"BODY":{"space_id":280,"tuple":[512,1,"test","memtx",0,{},[]]},"HEADER":{"type":"INSERT","timestamp":1475796386.2291,"lsn":2,"server_id":1}}'
  - '{"BODY":{"space_id":288,"tuple":[512,0,"primary","tree",{"unique":true,"lsn":2},[[0,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":1475796409.4258,"lsn":3,"server_id":1}}'
  - '{"BODY":{"space_id":512,"tuple":[1,2,3,4]},"HEADER":{"type":"INSERT","timestamp":1475796454.2693,"lsn":4,"server_id":1}}'
  - '{"BODY":{"space_id":512,"tuple":[2,2,3,4]},"HEADER":{"type":"REPLACE","timestamp":1475796459.9428,"lsn":5,"server_id":1}}'
  - '{"BODY":{"space_id":512,"key":[1]},"HEADER":{"type":"DELETE","timestamp":1475796470.6977,"lsn":6,"server_id":1}}'
  - '{"BODY":{"space_id":512,"index_base":1,"key":[2],"tuple":[["=",3,4]]},"HEADER":{"type":"UPDATE","timestamp":1475796500.8061,"lsn":7,"server_id":1}}'
  - '{"BODY":{"space_id":512,"operations":[["=",3,4]],"index_base":1,"tuple":[3,4,5,6]},"HEADER":{"type":"UPSERT","timestamp":1475796514.5016,"lsn":8,"server_id":1}}'
  - '{"BODY":{"space_id":512,"operations":[["=",3,4]],"index_base":1,"tuple":[3,4,5,6]},"HEADER":{"type":"UPSERT","timestamp":1475796515.7168,"lsn":9,"server_id":1}}'
  ../box/xlog_reader/v13/00000000000000000000.ok.snap:
  - '{"BODY":{"space_id":272,"tuple":["cluster","f7648d73-f4c0-40f8-9241-f57d4ec1b193"]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":1,"server_id":0}}'
  - '{"BODY":{"space_id":272,"tuple":["max_id",511]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":2,"server_id":0}}'
  - '{"BODY":{"space_id":272,"tuple":["version",1,7,2]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":3,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[272,1,"_schema","memtx",0,{},[{"type":"str","name":"key"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":4,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[280,1,"_space","memtx",0,{},[{"name":"id","type":"num"},{"name":"owner","type":"num"},{"name":"name","type":"str"},{"name":"engine","type":"str"},{"name":"field_count","type":"num"},{"name":"flags","type":"str"},{"name":"format","type":"*"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":5,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[281,1,"_vspace","sysview",0,{},[{"name":"id","type":"num"},{"name":"owner","type":"num"},{"name":"name","type":"str"},{"name":"engine","type":"str"},{"name":"field_count","type":"num"},{"name":"flags","type":"str"},{"name":"format","type":"*"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":6,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[288,1,"_index","memtx",0,{},[{"name":"id","type":"num"},{"name":"iid","type":"num"},{"name":"name","type":"str"},{"name":"type","type":"str"},{"name":"opts","type":"array"},{"name":"parts","type":"array"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":7,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[289,1,"_vindex","sysview",0,{},[{"name":"id","type":"num"},{"name":"iid","type":"num"},{"name":"name","type":"str"},{"name":"type","type":"str"},{"name":"opts","type":"array"},{"name":"parts","type":"array"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":8,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[296,1,"_func","memtx",0,{},[{"name":"id","type":"num"},{"name":"owner","type":"num"},{"name":"name","type":"str"},{"name":"setuid","type":"num"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":9,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[297,1,"_vfunc","sysview",0,{},[{"name":"id","type":"num"},{"name":"owner","type":"num"},{"name":"name","type":"str"},{"name":"setuid","type":"num"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":10,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[304,1,"_user","memtx",0,{},[{"name":"id","type":"num"},{"name":"owner","type":"num"},{"name":"name","type":"str"},{"name":"type","type":"str"},{"name":"auth","type":"*"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":11,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[305,1,"_vuser","sysview",0,{},[{"name":"id","type":"num"},{"name":"owner","type":"num"},{"name":"name","type":"str"},{"name":"type","type":"str"},{"name":"auth","type":"*"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":12,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[312,1,"_priv","memtx",0,{},[{"name":"grantor","type":"num"},{"name":"grantee","type":"num"},{"name":"object_type","type":"str"},{"name":"object_id","type":"num"},{"name":"privilege","type":"num"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":13,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[313,1,"_vpriv","sysview",0,{},[{"name":"grantor","type":"num"},{"name":"grantee","type":"num"},{"name":"object_type","type":"str"},{"name":"object_id","type":"num"},{"name":"privilege","type":"num"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":14,"server_id":0}}'
  - '{"BODY":{"space_id":280,"tuple":[320,1,"_cluster","memtx",0,{},[{"name":"id","type":"num"},{"name":"uuid","type":"str"}]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":15,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[272,0,"primary","tree",{"unique":true},[[0,"string"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":16,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[280,0,"primary","tree",{"unique":true},[[0,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":17,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[280,1,"owner","tree",{"unique":false},[[1,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":18,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[280,2,"name","tree",{"unique":true},[[2,"string"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":19,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[281,0,"primary","tree",{"unique":true},[[0,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":20,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[281,1,"owner","tree",{"unique":false},[[1,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":21,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[281,2,"name","tree",{"unique":true},[[2,"string"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":22,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[288,0,"primary","tree",{"unique":true},[[0,"unsigned"],[1,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":23,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[288,2,"name","tree",{"unique":true},[[0,"unsigned"],[2,"string"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":24,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[289,0,"primary","tree",{"unique":true},[[0,"unsigned"],[1,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":25,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[289,2,"name","tree",{"unique":true},[[0,"unsigned"],[2,"string"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":26,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[296,0,"primary","tree",{"unique":true},[[0,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":27,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[296,1,"owner","tree",{"unique":false},[[1,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":28,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[296,2,"name","tree",{"unique":true},[[2,"string"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":29,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[297,0,"primary","tree",{"unique":true},[[0,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":30,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[297,1,"owner","tree",{"unique":false},[[1,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":31,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[297,2,"name","tree",{"unique":true},[[2,"string"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":32,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[304,0,"primary","tree",{"unique":true},[[0,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":33,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[304,1,"owner","tree",{"unique":false},[[1,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":34,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[304,2,"name","tree",{"unique":true},[[2,"string"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":35,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[305,0,"primary","tree",{"unique":true},[[0,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":36,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[305,1,"owner","tree",{"unique":false},[[1,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":37,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[305,2,"name","tree",{"unique":true},[[2,"string"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":38,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[312,0,"primary","tree",{"unique":true},[[1,"unsigned"],[2,"string"],[3,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":39,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[312,1,"owner","tree",{"unique":false},[[0,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":40,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[312,2,"object","tree",{"unique":false},[[2,"string"],[3,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":41,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[313,0,"primary","tree",{"unique":true},[[1,"unsigned"],[2,"string"],[3,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":42,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[313,1,"owner","tree",{"unique":false},[[0,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":43,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[313,2,"object","tree",{"unique":false},[[2,"string"],[3,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":44,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[320,0,"primary","tree",{"unique":true},[[0,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":45,"server_id":0}}'
  - '{"BODY":{"space_id":288,"tuple":[320,1,"uuid","tree",{"unique":true},[[1,"string"]]]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":46,"server_id":0}}'
  - '{"BODY":{"space_id":296,"tuple":[1,1,"box.schema.user.info",1,"LUA"]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":47,"server_id":0}}'
  - '{"BODY":{"space_id":304,"tuple":[0,1,"guest","user",{"chap-sha1":"vhvewKp0tNyweZQ+cFKAlsyphfg="}]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":48,"server_id":0}}'
  - '{"BODY":{"space_id":304,"tuple":[1,1,"admin","user"]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":49,"server_id":0}}'
  - '{"BODY":{"space_id":304,"tuple":[2,1,"public","role"]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":50,"server_id":0}}'
  - '{"BODY":{"space_id":304,"tuple":[3,1,"replication","role"]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":51,"server_id":0}}'
  - '{"BODY":{"space_id":312,"tuple":[1,0,"role",2,4]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":52,"server_id":0}}'
  - '{"BODY":{"space_id":312,"tuple":[1,1,"universe",0,7]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":53,"server_id":0}}'
  - '{"BODY":{"space_id":312,"tuple":[1,2,"function",1,4]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":54,"server_id":0}}'
  - '{"BODY":{"space_id":312,"tuple":[1,2,"space",281,1]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":55,"server_id":0}}'
  - '{"BODY":{"space_id":312,"tuple":[1,2,"space",289,1]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":56,"server_id":0}}'
  - '{"BODY":{"space_id":312,"tuple":[1,2,"space",297,1]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":57,"server_id":0}}'
  - '{"BODY":{"space_id":312,"tuple":[1,2,"space",305,1]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":58,"server_id":0}}'
  - '{"BODY":{"space_id":312,"tuple":[1,2,"space",313,1]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":59,"server_id":0}}'
  - '{"BODY":{"space_id":312,"tuple":[1,3,"space",320,2]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":60,"server_id":0}}'
  - '{"BODY":{"space_id":312,"tuple":[1,3,"universe",0,1]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":61,"server_id":0}}'
  - '{"BODY":{"space_id":320,"tuple":[1,"f09eae7a-e876-45f1-b9f5-6995d13de2b0"]},"HEADER":{"type":"INSERT","timestamp":0,"lsn":62,"server_id":0}}'
...
collect_results("../box/xlog_reader/version.bad.xlog")
---
- error: '[string "function collect_results(file)     local val ..."]:1: ../box/xlog_reader/version.bad.xlog:
    unsupported file format version ''0.14'''
...
collect_results("../box/xlog_reader/format.bad.xlog")
---
- ../box/xlog_reader/format.bad.xlog
- - '{"BODY":{"space_id":272,"index_base":1,"key":["max_id"],"tuple":[["+",2,1]]},"HEADER":{"type":"UPDATE","timestamp":1475796386.2266,"lsn":1,"server_id":1}}'
  - '{"BODY":{"space_id":280,"tuple":[512,1,"test","memtx",0,{},[]]},"HEADER":{"type":"INSERT","timestamp":1475796386.2291,"lsn":2,"server_id":1}}'
  - '{"BODY":{"space_id":288,"tuple":[512,0,"primary","tree",{"unique":true,"lsn":2},[[0,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":1475796409.4258,"lsn":3,"server_id":1}}'
  - '{"BODY":{"space_id":512,"tuple":[1,2,3,4]},"HEADER":{"type":"INSERT","timestamp":1475796454.2693,"lsn":4,"server_id":1}}'
  - '{"BODY":{"space_id":512,"tuple":[2,2,3,4]},"HEADER":{"type":"REPLACE","timestamp":1475796459.9428,"lsn":5,"server_id":1}}'
  - '{"BODY":{"space_id":512,"key":[1]},"HEADER":{"type":"DELETE","timestamp":1475796470.6977,"lsn":6,"server_id":1}}'
  - '{"BODY":{"space_id":512,"index_base":1,"key":[2],"tuple":[["=",3,4]]},"HEADER":{"type":"UPDATE","timestamp":1475796500.8061,"lsn":7,"server_id":1}}'
  - '{"BODY":{"space_id":512,"operations":[["=",3,4]],"index_base":1,"tuple":[3,4,5,6]},"HEADER":{"type":"UPSERT","timestamp":1475796514.5016,"lsn":8,"server_id":1}}'
  - '{"BODY":{"space_id":512,"operations":[["=",3,4]],"index_base":1,"tuple":[3,4,5,6]},"HEADER":{"type":"UPSERT","timestamp":1475796515.7168,"lsn":9,"server_id":1}}'
...
collect_results("../box/xlog_reader/crc.bad.xlog")
---
- ../box/xlog_reader/crc.bad.xlog
- - '{"BODY":{"space_id":272,"index_base":1,"key":["max_id"],"tuple":[["+",2,1]]},"HEADER":{"type":"UPDATE","timestamp":1475796386.2266,"lsn":1,"server_id":1}}'
  - '{"BODY":{"space_id":280,"tuple":[512,1,"test","memtx",0,{},[]]},"HEADER":{"type":"INSERT","timestamp":1475796386.2291,"lsn":2,"server_id":1}}'
  - '{"BODY":{"space_id":288,"tuple":[512,0,"primary","tree",{"unique":true,"lsn":2},[[0,"unsigned"]]]},"HEADER":{"type":"INSERT","timestamp":1475796409.4258,"lsn":3,"server_id":1}}'
  - '{"BODY":{"space_id":512,"tuple":[1,2,3,4]},"HEADER":{"type":"INSERT","timestamp":1475796454.2693,"lsn":4,"server_id":1}}'
...
